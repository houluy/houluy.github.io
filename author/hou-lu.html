<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>LuCima's SpaCe - Hou, Lu</title>
        <link rel="stylesheet" href="https://houluy.github.io/theme/css/main.css" />

        <!--[if IE]>
            <script src="https://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a href="https://github.com/houluy/">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="https://houluy.github.io/">LuCima's SpaCe </a></h1>
                <nav><ul>
                    <li><a href="https://houluy.github.io/category/elasticsearch.html">Elasticsearch</a></li>
                    <li><a href="https://houluy.github.io/category/games.html">Games</a></li>
                    <li><a href="https://houluy.github.io/category/python-notes.html">Python-NOTes</a></li>
                    <li><a href="https://houluy.github.io/category/security.html">Security</a></li>
                </ul></nav>
        </header><!-- /#banner -->

            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href="https://houluy.github.io/learning-elasticsearch-ii.html">Learning Elasticsearch (ii)</a></h1>
<footer class="post-info">
        <abbr class="published" title="2017-06-14T00:00:00+08:00">
                Published: 三 14 六月 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://houluy.github.io/author/hou-lu.html">Hou, Lu</a>
        </address>
<p>In <a href="https://houluy.github.io/category/elasticsearch.html">Elasticsearch</a>.</p>
<p>tags: <a href="https://houluy.github.io/tag/elasticsearch.html">Elasticsearch</a> </p>
</footer><!-- /.post-info --><p>希望限制<code>search</code>接口返回的字段，通过在<code>query</code>属性中增加{ '_source': '*' }来做限制，或在SDK的search函数中增加参数:</p>
<div class="highlight"><pre><span></span><span class="n">es</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">_source</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;a&#39;</span><span class="p">,</span> <span class="s1">&#39;b&#39;</span><span class="p">])</span>
</pre></div>


<p>返回只包含字段'a'与'b'的值。</p>
<h2>动态更新Elasticsearch部分配置</h2>
<p>如果需要不停机更新Elasticsearch的配置，可以使用Elasticsearch的动态配置修改机制。在Python中，使用<code>ClusterClient</code>实例完成：  </p>
<div class="highlight"><pre><span></span>
</pre></div>


<h2>Elasticsearch快照</h2>
<p>当我们需要定期为数据做备份时，可以使用Elasticsearch提供的快照(snapshot)功能。要如此，我们需要先注册一个快照的仓库(repository).在Python SDK中，快照的操作由快照实例完成：  </p>
<div class="highlight"><pre><span></span><span class="n">sc</span> <span class="o">=</span> <span class="n">elasticsearch</span><span class="o">.</span><span class="n">client</span><span class="o">.</span><span class="n">SnapshotClient</span><span class="p">(</span><span class="n">es</span><span class="p">)</span>
<span class="c1">#Get a repo</span>
<span class="n">repo</span> <span class="o">=</span> <span class="n">sc</span><span class="o">.</span><span class="n">get_repository</span><span class="p">()</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">repo</span><span class="p">:</span>
    <span class="c1">#Create a repo</span>
    <span class="n">repo_settings</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;fs&#39;</span><span class="p">,</span>
        <span class="s1">&#39;settings&#39;</span><span class="p">:</span> <span class="p">{</span>
            <span class="s1">&#39;compress&#39;</span><span class="p">:</span> <span class="s1">&#39;true&#39;</span><span class="p">,</span>
            <span class="s1">&#39;location&#39;</span><span class="p">:</span> <span class="s1">&#39;/tmp/back&#39;</span><span class="p">,</span>
        <span class="p">},</span>
    <span class="p">}</span>
    <span class="n">sc</span><span class="o">.</span><span class="n">create_repository</span><span class="p">(</span><span class="n">repository</span><span class="o">=</span><span class="s1">&#39;repo_name&#39;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">repo_settings</span><span class="p">)</span>
</pre></div>


<p>返回<code>{acknowlegement: True}</code>表示创建成功。注意：<code>location</code>属性所指定的位置必须在配置文件的<code>path.repo</code>列表中。例如：<code>path.repo: ['/tmp/back', '/root/back']</code>。
<code>path.repo</code>属性不支持动态更新。</p>
<p>之后，为指定的索引创建快照：</p>
<div class="highlight"><pre><span></span><span class="n">snapshot_body</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;indices&#39;</span><span class="p">:</span> <span class="s1">&#39;_all&#39;</span><span class="p">,</span> <span class="c1">#indices that need backup</span>
    <span class="s1">&#39;ignore_unavailable&#39;</span><span class="p">:</span> <span class="bp">True</span><span class="p">,</span>
<span class="p">}</span>
<span class="n">sc</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">repository</span><span class="o">=</span><span class="s1">&#39;repo_name&#39;</span><span class="p">,</span> <span class="n">snapshot</span><span class="o">=</span><span class="s1">&#39;snap_name&#39;</span><span class="p">,</span> <span class="n">body</span><span class="o">=</span><span class="n">snapshot_body</span><span class="p">,</span> <span class="n">wait_for_completion</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>


<p><code>wait_for_completion=True</code>将等待快照完全创建结束后获取创建结果。  </p>
<h3>快照恢复</h3>                </article>
            </aside><!-- /#featured -->
                <section id="content" class="body">
                    <h1>Other articles</h1>
                    <hr />
                    <ol id="posts-list" class="hfeed">

            <li><article class="hentry">
                <header>
                    <h1><a href="https://houluy.github.io/learning-elasticsearch-i.html" rel="bookmark"
                           title="Permalink to Learning Elasticsearch (i)">Learning Elasticsearch (i)</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-05-24T00:00:00+08:00">
                Published: 三 24 五月 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://houluy.github.io/author/hou-lu.html">Hou, Lu</a>
        </address>
<p>In <a href="https://houluy.github.io/category/elasticsearch.html">Elasticsearch</a>.</p>
<p>tags: <a href="https://houluy.github.io/tag/elasticsearch.html">Elasticsearch</a> </p>
</footer><!-- /.post-info -->                <p>This serie of posts introduces basic usage of Elasticsearch in 中文</p>
                <a class="readmore" href="https://houluy.github.io/learning-elasticsearch-i.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://houluy.github.io/an-tic-tac-toe-with-ai.html" rel="bookmark"
                           title="Permalink to An Tic Tac Toe with AI">An Tic Tac Toe with AI</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-03-23T00:00:00+08:00">
                Published: 四 23 三月 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://houluy.github.io/author/hou-lu.html">Hou, lu</a>
        </address>
<p>In <a href="https://houluy.github.io/category/games.html">Games</a>.</p>

</footer><!-- /.post-info -->                
                <a class="readmore" href="https://houluy.github.io/an-tic-tac-toe-with-ai.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://houluy.github.io/cerberus-triple-head-hound-of-hades.html" rel="bookmark"
                           title="Permalink to Cerberus: Triple-head hound of Hades">Cerberus: Triple-head hound of Hades</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2017-01-17T00:00:00+08:00">
                Published: 二 17 一月 2017
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://houluy.github.io/author/hou-lu.html">Hou, lu</a>
        </address>
<p>In <a href="https://houluy.github.io/category/python-notes.html">Python-NOTes</a>.</p>

</footer><!-- /.post-info -->                <p>rules_set_registry: only stores schema itself, for example <code>{'type': 'string', 'required': True}</code><br>
schema_registry: stores complete schema, for example <code>{'name': {'type': 'string', 'required': True}}</code>, it can be used directly.  </p>
<p>It's not easy to <code>allow_unknown</code> for parent schema (for nested dict), because you cannot put <code>allow_unknown</code> inside the defination of schema. You have …</p>
                <a class="readmore" href="https://houluy.github.io/cerberus-triple-head-hound-of-hades.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://houluy.github.io/on-the-beginning.html" rel="bookmark"
                           title="Permalink to On the BeGinNing">On the BeGinNing</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-12-23T00:00:00+08:00">
                Published: 五 23 十二月 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://houluy.github.io/author/hou-lu.html">Hou, lu</a>
        </address>
<p>In <a href="https://houluy.github.io/category/python-notes.html">Python-NOTes</a>.</p>

</footer><!-- /.post-info -->                <p>Welcome to visit 'python-NOTes' category in LuCima's SpaCe. Here gathers several posts summerized advanced usages, tips and black techs about Python. All contents are based on Python 3.x, though Python 2.x may be referred to shortly.  </p>
                <a class="readmore" href="https://houluy.github.io/on-the-beginning.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://houluy.github.io/operaions-on-basic-data-structure-dict.html" rel="bookmark"
                           title="Permalink to Operaions on Basic data structure -- dict">Operaions on Basic data structure -- dict</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-12-23T00:00:00+08:00">
                Published: 五 23 十二月 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://houluy.github.io/author/hou-lu.html">Hou, lu</a>
        </address>
<p>In <a href="https://houluy.github.io/category/python-notes.html">Python-NOTes</a>.</p>

</footer><!-- /.post-info -->                <h1>Series of posts (2)</h1>
<p>If you want to build up a dict using two lists, <code>zip()</code> can be used as this:<br>
<code>dict(zip(list_a, list_b))</code></p>
<p>Sometimes, <code>OrderedDict</code> and <code>DefaultDict</code> in module <code>collections</code> can be useful. When you need a dict whose keys are </p>
                <a class="readmore" href="https://houluy.github.io/operaions-on-basic-data-structure-dict.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://houluy.github.io/operaions-on-basic-data-structure-list.html" rel="bookmark"
                           title="Permalink to Operaions on Basic data structure -- list">Operaions on Basic data structure -- list</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-12-23T00:00:00+08:00">
                Published: 五 23 十二月 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://houluy.github.io/author/hou-lu.html">Hou, lu</a>
        </address>
<p>In <a href="https://houluy.github.io/category/python-notes.html">Python-NOTes</a>.</p>

</footer><!-- /.post-info -->                <h1>Series of posts (1)</h1>
<style type="text/css">
.keywords {
    color:#1E90FF;    
    font-weight:bold;
}
</style>

<p>Here I am going to summarize some advancing operations about <span class='keywords'>list</span>, which is one of the most commonly used data structure in Python. Basic usage of list will be skipped.  </p>
<p>The built-in function <code>sorted()</code> is helpful for sorting the <span class='keywords'>list</span> or …</p>
                <a class="readmore" href="https://houluy.github.io/operaions-on-basic-data-structure-list.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://houluy.github.io/operations-on-file-and-path.html" rel="bookmark"
                           title="Permalink to Operations on FILE and PATH">Operations on FILE and PATH</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-12-21T00:00:00+08:00">
                Published: 三 21 十二月 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://houluy.github.io/author/hou-lu.html">Hou, lu</a>
        </address>
<p>In <a href="https://houluy.github.io/category/python-notes.html">Python-NOTes</a>.</p>

</footer><!-- /.post-info -->                <p>This post is going to introduce Python's' operations upon files and paths in OS. The most commonly used modules are <code>os.path</code> and <code>shutil</code>.</p>
                <a class="readmore" href="https://houluy.github.io/operations-on-file-and-path.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://houluy.github.io/how-to-implement-user-datagram-protocol-with-python-raw-socket.html" rel="bookmark"
                           title="Permalink to How to implement User Datagram Protocol with Python RAW socket">How to implement User Datagram Protocol with Python RAW socket</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-12-20T00:00:00+08:00">
                Published: 二 20 十二月 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://houluy.github.io/author/hou-lu.html">Hou, lu</a>
        </address>
<p>In <a href="https://houluy.github.io/category/python-notes.html">Python-NOTes</a>.</p>

</footer><!-- /.post-info -->                <p>one’s complement in UDP  </p>
<ol>
<li>Construct the UDP header and UDP Pseudo header, as illustrated below, where Checksum is set zero at first.  </li>
<li>Check the length of data, if it is an odd length of bytes, supplement a byte of zero (0x00) at the end of the data when counting …</li></ol>
                <a class="readmore" href="https://houluy.github.io/how-to-implement-user-datagram-protocol-with-python-raw-socket.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>

            <li><article class="hentry">
                <header>
                    <h1><a href="https://houluy.github.io/about-refresh_token.html" rel="bookmark"
                           title="Permalink to About refresh_token">About refresh_token</a></h1>
                </header>

                <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2016-12-18T00:00:00+08:00">
                Published: 日 18 十二月 2016
        </abbr>

        <address class="vcard author">
                By                         <a class="url fn" href="https://houluy.github.io/author/hou-lu.html">Hou, lu</a>
        </address>
<p>In <a href="https://houluy.github.io/category/security.html">Security</a>.</p>

</footer><!-- /.post-info -->                <p>This post talks about security in web login system.</p>
<p>The utility of refresh token </p>
<p>It is a compromise between using refresh token and re-authentication by username and password. Refresh token reduce the probability of password disclosure and 
give convenience for users since they don''t have to re-input their passwords repeatly …</p>
                <a class="readmore" href="https://houluy.github.io/about-refresh_token.html">read more</a>
                </div><!-- /.entry-content -->
            </article></li>
                </ol><!-- /#posts-list -->
<p class="paginator">
    Page 1 / 2
        <a href="https://houluy.github.io/author/hou-lu2.html">&raquo;</a>
</p>
                </section><!-- /#content -->
        <section id="extras" class="body">
                <div class="blogroll">
                        <h2>links</h2>
                        <ul>
                            <li><a href="http://getpelican.com/">Pelican</a></li>
                            <li><a href="http://python.org/">Python.org</a></li>
                            <li><a href="http://jinja.pocoo.org/">Jinja2</a></li>
                            <li><a href="http://blog.insanecoder.top/">Zhao, Shaohang</a></li>
                        </ul>
                </div><!-- /.blogroll -->
                <div class="social">
                        <h2>social</h2>
                        <ul>

                            <li><a href="https://github.com/houluy">github</a></li>
                            <li><a href="http://stackoverflow.com/users/6818280/lucima">Stackoverflow</a></li>
                            <li><a href="https://www.linkedin.com/in/houlu">LinkedIn</a></li>
                            <li><a href="mailto:houlu8674@bupt.edu.cn">Email</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

</body>
</html>